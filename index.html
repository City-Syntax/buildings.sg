<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buildings.sg</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.9.2/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.9.2/mapbox-gl.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.5.0/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.5.0/mapbox-gl-draw.css"
        type="text/css">
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9SKSBMB2TX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-9SKSBMB2TX');
    </script>

    <link rel="stylesheet" href="mapboxgl.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f0;
        }

        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            color: #fff;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
        }

        .loadingContent {
            text-align: center;
        }

        .loadingContent p {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            line-height: 2;
        }

        .progressBar {
            width: 300px;
            height: 8px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .progressBarInner {
            height: 100%;
            width: 0%;
            background-color: #f0f0f0;
            transition: width 0.3s ease;
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
        }

        #geocoder {
            position: absolute;
            border: 0;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        .header {
            margin-left: 5px;
            margin-right: 0;
            background-color: #333;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            z-index: 1;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
        }

        .header .title {
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            color: #fff;
            line-height: 1;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
        }

        .header .nav {
            display: flex;
            gap: 20px;
            align-items: center;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
        }

        .header .nav a {
            text-decoration: none;
            color: #f0f0f0;
            font-size: 12px;
            line-height: 1;
            transition: color 0.3s ease;
        }

        .header .nav a:hover,
        .header .nav a:active {
            color: #fff;
            font-weight: bold;
        }

        .header .nav .active {
            color: #fff;
            font-weight: bold;
        }


        /* 弹出框样式 */
        .popup {
            position: fixed;
            top: 55px;
            right: 10px;
            width: calc(100% - 490px);
            bottom: 30px;
            padding: 20px;
            font-size: 12px;
            line-height: 18px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 100;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .popup::-webkit-scrollbar {
            width: 0px;
            background-color: transparent;
        }

        .popup h2 {
            display: block;
            width: 100%;
            margin-top: 0;
            font-size: larger;
            font-weight: bold;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 16px;
        }

        .popup .link {
            color: #333;
            text-decoration: none;
            font-weight: bold;
        }

        .popup table,
        .popup th,
        .popup td {
            overflow: hidden;
            border: 1px solid #ddd;
        }

        .popup th,
        .popup td {
            text-align: left;
            padding: 8px;
        }

        .popup td:first-child,
        .popup th:first-child {
            font-weight: bold;
        }

        .popup-content {
            width: 100%;
        }

        .popup table {
            width: 100%;
            margin-top: 10px;
            font-size: 12px;
            border-collapse: collapse;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 99;
        }

        #data-sub-buttons {
            display: none;
            flex-direction: column;
            position: fixed;
            width: 100px;
            height: 100px;
            top: 50px;
            right: 45px;
            background: transparent;
            z-index: 5;
        }

        #data-sub-buttons.show {
            display: block;
        }

        #data-sub-buttons button {
            width: 100px;
            text-align: center;
            padding: 5px 10px;
            margin-top: 5px;
            color: #fff;
            background-color: #333;
            border-radius: 10px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            border: 0;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        #data-sub-buttons button:hover,
        #data-sub-buttons button:active {
            color: #fff;
            font-weight: bold;
        }

        #data-sub-buttons button.active {
            color: #333;
            background-color: #fff;
            font-weight: bold;
        }

        #popupDownload {
            display: none;
            width: 100%;
            flex-direction: column;
        }

        .download-grid {
            display: flex !important;
            flex-wrap: wrap;
            gap: 10px;
            padding-bottom: 15px;
            width: 100%;
            box-sizing: border-box;
        }

        .download-item {
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: transform 0.2s;
            width: 120px;
            height: 120px;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .download-item img {
            width: 120px;
            height: 120px;
            border-radius: 10px;
            filter: grayscale(100%) contrast(90%) brightness(120%) invert(20%);
            transition: filter 0.3s ease;
        }

        .download-item:hover img {
            filter: grayscale(0%) contrast(100%) brightness(100%) invert(0%);
        }

        .download-tooltip {
            position: absolute;
            bottom: 0px;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 12px;
            font-weight: bold;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 10px;
            opacity: 0;
            box-sizing: border-box;
            transition: opacity 0.3s ease;
        }

        .download-item:hover .download-tooltip {
            opacity: 1;
        }

        .download-label {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            padding: 4px 6px;
            box-sizing: border-box;
            pointer-events: none;
        }

        .download-item:hover .download-label {
            opacity: 0;
        }

        #close-btn {
            display: block;
            font-size: 12px;
            margin: 20px auto 0px auto;
            padding: 8px 12px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
        }


        .calculation-box {
            width: 230px;
            position: absolute;
            top: 256px;
            max-height: 300px;
            right: 10px;
            background-color: #fff;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            padding: 0 5px;
            border-radius: 10px;
            color: #333;
            font-size: 12px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: left;
            display: none;
        }

        .calculation-box h3 {
            font-family: 'Roboto Mono', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bold;
            font-size: 12px;
            color: #007cbf;
            margin: 15px 10px;
        }

        .calculation-box p {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            margin-left: 10px;
            line-height: 0.75;
        }

        .calculation-box .closex {
            position: absolute;
            top: 5px;
            right: 5px;
            font-weight: 500;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            color: #666;
        }

        .close-btn:hover {
            color: #333;
            border: none;
        }

        /* BCA 下拉按钮 */
        .buttons-container {
            display: none;
            flex-direction: column;
            position: fixed;
            width: 165px;
            height: 100px;
            top: 50px;
            right: 85px;
            background: transparent;
            z-index: 5;
        }

        .buttons-container.show {
            display: block;
        }

        .buttons-container button {
            width: 165px;
            text-align: center;
            padding: 5px 10px;
            margin-top: 5px;
            color: #fff;
            background-color: #333;
            border-radius: 10px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            border: 0;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .buttons-container button:hover,
        .buttons-container button:active {
            color: #fff;
            font-weight: bold;
        }

        .buttons-container button.active {
            color: #333;
            background-color: #fff;
            font-weight: bold;
        }

        /* 图例容器的样式 */
        .legend-container-bca {
            display: none;
            opacity: 0;
            visibility: hidden;
            z-index: 40;
        }

        .legend-container-bca.show {
            display: block;
            opacity: 1;
            visibility: visible;
        }

        .legend-name {
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            font-weight: bold;
            color: #333;
            margin-left: 5px;
            margin-bottom: 10px;
        }

        /* 图例内容的隐藏样式 */
        .legend-content {
            position: fixed;
            width: 220px;
            bottom: 75px;
            right: 10px;
            background-color: #fff;
            padding: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            display: none;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
        }

        .legend-content.show {
            display: block;
        }

        .legend-grid-bca {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            row-gap: 5px;
            column-gap: 27px;
            margin-left: 5px;
        }

        .legend-item-bca {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 10px;
        }

        .legend-box-bca {
            width: 20px;
            height: 12px;
            border-radius: 10px;
        }

        .legend-bar-eui {
            width: 220px;
            height: 15px;
            background: linear-gradient(to right, #5cfe2f, #146aff, #a114ff);
            border-radius: 10px;
            margin-bottom: 5px;
            margin-right: 40px;
        }

        .legend-bar-gfa {
            width: 220px;
            height: 15px;
            background: linear-gradient(to right,
                    #660b27 0%,
                    #e07410 20%,
                    #faef14 50%,
                    #c8dd69 100%);
            border-radius: 10px;
            margin-bottom: 5px;
            margin-right: 40px;
        }

        /* Green Mark 颜色定义 */
        .greenmark-goldplus {
            background-color: #fff457;
        }

        .greenmark-gold {
            background-color: #d6ff33;
        }

        .greenmark-platinum {
            background-color: #7eff3d;
        }

        .greenmark-legislated {
            background-color: #00ff62;
        }

        .greenmark-certified {
            background-color: #0affb1;
        }

        /* Main Layers Legend*/
        .legend-main {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
        }

        .legend-container {
            display: block;
            position: fixed;
            width: 220px;
            bottom: 75px;
            right: 10px;
            background-color: #fff;
            padding: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            display: none;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
        }

        .legend-container.active {
            display: block;
        }

        .legend-container.show {
            opacity: 1;
        }

        .legend-labels {
            display: flex;
            justify-content: space-between;
            color: #333;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr;
            row-gap: 5px;
            column-gap: 10px;
            margin-left: 5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 5px;
        }

        .legend-box {
            width: 12px;
            height: 12px;
            border-radius: 10px;
        }

        /* Archetypes 颜色定义*/
        .legend-public-housing {
            background-color: #1abc9c;
        }

        .legend-landed-property {
            background-color: #2ecc71;
        }

        .legend-private-apartment {
            background-color: #3498db;
        }

        .legend-other-dwelling {
            background-color: #9b59b6;
        }

        .legend-educational {
            background-color: #e67e22;
        }

        .legend-healthcare {
            background-color: #f1c40f;
        }

        .legend-commercial {
            background-color: #34495e;
        }

        .legend-industrial {
            background-color: #e74c3c;
        }

        .legend-others {
            background-color: #95a5a6;
        }

        .legend-unknown {
            background-color: #ffffff;
            border: 1px solid #ccc;
        }

        .legend-bar-energy {
            width: 220px;
            height: 15px;
            background: linear-gradient(to right,
                    #0d9c6c 0%,
                    #57f46c 30%,
                    #f5ed0f 60%,
                    #f56b0f 100%);
            border-radius: 10px;
            margin-bottom: 5px;
            margin-right: 40px;
        }

        .legend-bar-carbon {
            width: 220px;
            height: 15px;
            background: linear-gradient(to right,
                    #2bf3a9 0%,
                    #0fb89f 20%,
                    #275fa0 40%,
                    #df80e0 70%,
                    #f0004c 100%);
            border-radius: 10px;
            margin-bottom: 5px;
            margin-right: 40px;
        }

        /* Result Panel*/
        .result-panel {
            position: fixed;
            top: 50px;
            left: 12px;
            bottom: 30px;
            width: 420px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            margin-top: 5px;
            display: none;
            overflow-y: auto;
            overflow: hidden;
        }

        .result-panel.show {
            display: block;
        }

        .result-panel select {
            position: relative;
            top: 0px;
            left: 10px;
            background-color: #333;
            color: #fff;
            border: 0px;
            border-radius: 10px;
            padding: 5px 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            font-size: 12px;
        }

        .result-panel select option {
            margin-top: 10px;
            background-color: #fff;
            color: #333;
            border-color: #fff;
            border-radius: 10px;
            padding: 5px 10px;
            font-size: 12px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .result-panel select:hover {
            background-color: #333;
        }

        .result-panel select::-ms-expand {
            margin-right: 12px;
        }

        .result-panel .subtype-btn {
            width: 130px;
            border: 0px;
        }

        .result-panel .archetype-btn {
            width: 200px;
            border: 0px;
        }

        .result-panel .clear-btn {
            position: relative;
            top: 0px;
            left: 10px;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 5px 10.5px;
            cursor: pointer;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            font-size: 12px;
        }

        .result-panel .clear-btn:hover {
            background-color: #333;
        }

        .simulation-header h2 {
            position: relative;
            top: 0px;
            left: 15px;
            font-size: larger;
            font-weight: bold;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 16px;
        }

        #toggle2D {
            position: fixed;
            top: 220px;
            right: 10px;
            padding: 8px 6px;
            background-color: #fff;
            color: #333;
            font-size: 12px;
            font-weight: bold;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1;
            border-width: 2px;
            border: none;
            outline: 2px solid rgba(50, 50, 50, 0.1);
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: background-color 0.1s, color 0.1s
        }

        #toggle2D:hover {
            background-color: #f5f5f5;
        }

        #toggle2D:active,
        #toggle2D.active {
            background-color: #333;
            color: #fff;
        }

        /* 关闭按钮样式 */
        .panel-close-btn {
            position: absolute;
            top: 7px;
            right: 10px;
            font-size: 14px;
            padding: 0px;
            background: none;
            border: none;
            border-radius: 10px;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            font-family: Verdana, sans-serif;
            transition: color 0.3s;
        }

        .panel-close-btn:hover {
            color: #333;
        }

        #archetype-charts {
            position: relative;
            top: 0px;
            width: 420px;
        }

        #sunchartsnumber {
            position: relative;
            top: 0px;
            width: 420px;
            height: 380px;
            z-index: 90;
            animation: showIcon 0.5s forwards;
            animation-delay: 0s;
        }

        #sunchartsfootprint {
            position: relative;
            top: 0px;
            width: 420px;
            height: 380px;
            z-index: 90;
            animation: showIcon 0.5s forwards;
            animation-delay: 0s;
            display: none;
        }

        #archetype-charts .container {
            display: flex;
            gap: 10px;
            width: 420px;
        }

        .sunchartname {
            position: relative;
            left: 15px;
            top: 0px;
            height: 26px;
            font-size: 12px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
        }

        #archetype-charts .toggle-container {
            display: flex;
            align-items: center;
            background: #ddd;
            border-radius: 11px;
            border: 1.5px solid #ddd;
            padding: 5px;
            width: 280px;
            height: 26px;
            position: relative;
            top: -5px;
            left: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            box-sizing: border-box;
        }

        #archetype-charts .toggle-option {
            flex: 1;
            text-align: center;
            line-height: 25px;
            font-size: 12px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            z-index: 10;
            position: relative;
        }

        #archetype-charts .toggle-option .active {
            color: #fff;
        }

        #archetype-charts .toggle-slider {
            position: absolute;
            width: 142px;
            height: 23px;
            background: #333;
            border-radius: 10px;
            transition: 0.3s;
            top: 0px;
            left: 0px;
        }

        #downloadSunChart {
            position: relative;
            left: 10px;
            top: -5px;
            height: 25px;
            width: 83px;
            line-height: 25px;
            text-align: center;
            color: #fff;
            font-size: 12px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            background: #333;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            cursor: pointer;
        }

        #downloadSunChart:hover {
            font-weight: bold;
        }

        #downloadSunChart.active {
            font-weight: bold;
        }

        #archetype-charts h3 {
            font-family: 'Roboto Mono', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bold;
            font-size: 12px;
            color: #007cbf;
            margin: 10px 15px;
        }

        #archetype-description {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            margin: 10px 15px;
            line-height: 1.25;
        }

        .result-container h3 {
            font-family: 'Roboto Mono', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bold;
            font-size: 12px;
            color: #007cbf;
            margin: 10px 15px;
        }

        .result-container h4 {
            font-family: 'Roboto Mono', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: bold;
            font-size: 12px;
            color: #333;
            margin: 10px 15px;
            flex: 1;
            min-width: 280px;
        }

        .result-container p {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            margin: 0px 15px;
            line-height: 1.5;
        }

        .result-underselect {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            width: 420px;
            margin-top: 10px;
        }

        .downloadBar {
            position: relative;
            top: 6px;
            margin-right: 10px;
            flex: 1;
            min-width: 90px;
            max-width: 90px;
            height: 25px;
            line-height: 25px;
            text-align: center;
            color: #fff;
            font-size: 12px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            background: #333;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            cursor: pointer;
        }

        #carbonChartContainer {
            position: relative;
            top: 0px;
            margin: -10px 10px 0px 15px;
            flex-basis: 100%;
            width: 390px;
            height: 420px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            font-size: 10px;
            z-index: 90;
            animation: showIcon 0.5s;
            animation-delay: 0s;
        }

        #carbonSubChart {
            position: relative;
            top: 0px;
            margin: 0px 10px 10px 15px;
            flex-basis: 100%;
            width: 390px;
            height: 420px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            font-size: 10px;
            z-index: 90;
            animation: showIcon 0.5s;
            animation-delay: 0s;
        }

        #energyChartContainer {
            position: relative;
            top: 0px;
            margin: -10px 10px 0px 15px;
            flex-basis: 100%;
            width: 390px;
            height: 420px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            font-size: 10px;
            z-index: 90;
            animation: showIcon 0.5s;
            animation-delay: 0s;
        }

        #energySubChart {
            position: relative;
            top: 0px;
            margin: 0px 10px 10px 15px;
            flex-basis: 100%;
            width: 390px;
            height: 420px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            font-size: 10px;
            z-index: 90;
            animation: showIcon 0.5s;
            animation-delay: 0s;
        }

        .result-content {
            display: none;
            flex-wrap: wrap;
            gap: 0px;
            width: 420px;
            margin-top: 10px;
        }

        .result-subtype {
            display: none;
            flex-wrap: wrap;
            gap: 0px;
            width: 420px;
            margin-top: 10px;
        }

        .image-container {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ddd;
            font-size: 12px;
            color: #333;
            margin: 10px 0px 0px 10px;
            width: 140px;
            height: 140px;
            border-radius: 10px;
            z-index: 40;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .image-container img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
            object-fit: contain;
        }

        .overview {
            display: flex;
            position: relative;
            flex-direction: column;
            flex: 1;
            min-width: 240px;
            top: 5px;
            line-height: 1.2;
            margin-right: 10px;
            margin-left: 0px;
        }

        .overview p {
            line-height: 1.5;
        }

        #archetype-value span,
        #ec-intensity span,
        #fitted-distribution span,
        #distribution-params span {
            display: inline-block;
        }

        .parameters {
            display: flex;
            position: relative;
            flex-direction: column;
            top: 0px;
            margin: 0px;
            flex-basis: 100%;
            min-width: 400px;
            min-height: 150px;
        }

        .result-content table {
            position: relative;
            margin: 0px 15px 0px 15px;
            min-width: 390px;
            height: 100px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            font-size: 12px;
            line-height: 1.5;
            border-collapse: collapse;
        }

        .result-content td {
            text-align: left;
        }

        .result-content th {
            text-align: center;
        }

        .result-content td:nth-child(2),
        .result-content td:nth-child(3) {
            text-align: right;
        }

        .result-content .figure {
            display: flex;
            position: relative;
            flex-direction: column;
            flex-basis: 100%;
            flex: 1;
            min-width: 400px;
            max-width: 410px;
            min-height: 160px;
            margin: 0px;
        }

        #energy-eui {
            position: relative;
            flex-basis: 100%;
            flex: 1;
            top: 0px;
            left: 15px;
            width: 395px;
            height: 180px;
            margin: 0px;
            animation-delay: 0s;
        }

        #carbonHistogram {
            position: relative;
            top: 0px;
            min-height: 260px !important;
            flex-basis: 100%;
            margin: 0px;
            margin-bottom: 10px;
            min-width: 415px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            font-size: 10px;
            animation-delay: 0s;
        }

        .downloadcharts {
            position: relative;
            left: 100px;
            top: 5px;
            margin-bottom: 25px;
            padding-left: 15px;
            padding-right: 15px;
            height: 25px;
            line-height: 25px;
            text-align: center;
            color: #fff;
            font-size: 12px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            background: #333;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            cursor: pointer;
        }

        .mlswitch-label {
            cursor: pointer;
            display: inline-block;
            width: 50px;
            height: 26px;
            background-color: #ddd;
            border-radius: 12px;
            position: relative;
            transition: background-color 0.3s ease;
        }

        .mlswitch-wrapper {
            position: fixed;
            left: 50%;
            transform: translateX(-145px);
            bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: white;
            border-radius: 10px;
            padding: 5px 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .toggle-mlswitch {
            display: none;
        }

        .mlswitch-label::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 18px;
            height: 18px;
            background-color: white;
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .toggle-mlswitch:checked+.mlswitch-label {
            background-color: #4CAF50;
        }

        .toggle-mlswitch:checked+.mlswitch-label::before {
            transform: translateX(24px);
        }

        .label-text {
            font-size: 12px;
            font-family: "Roboto Mono", Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }

        #visitor-counter {
            position: fixed;
            bottom: 5px;
            left: 100px;
            background-color: transparent;
            padding: 0px;
            font-size: 12px;
            color: #333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            z-index: 9;
        }
    </style>
</head>

<body>
    <div id="loadingOverlay">
        <div class="loadingContent">
            <p>Loading Buildings.sg<br>Carbon Map, Urban Building Energy Models & Scenarios for Singapore's Built
                Environment</p>
            <div class="progressBar">
                <div class="progressBarInner" id="progressBarInner"></div>
            </div>
        </div>
    </div>
    <script>
        window.chartDataLoaded = false;
        window.mapLoaded = false;

        function updateProgress(percent) {
            document.getElementById("progressBarInner").style.width = percent + "%";
        }

        function checkAllLoaded() {
            if (window.chartDataLoaded && window.mapLoaded) {
                updateProgress(100);
                setTimeout(() => {
                    document.getElementById("loadingOverlay").style.display = "none";
                }, 3000);
            }
        }
    </script>

    <header class="header">
        <a href="index.html" class="title">Buildings.sg</a>
        <nav class="nav">
            <a href="#" id="type-link" data-content="type" class="nav-link">Archetype</a>
            <a href="#" id="carbon-link" data-content="carbon" class="nav-link">Embodied Carbon</a>
            <a href="#" id="energy-link" data-content="energy" class="nav-link">Operational Carbon</a>
            <a href="#" id="bca-link" data-content="bca">BCA Layers</a>
            <a href="#" id="data-link" class="nav-link">Data</a>
            <a href="#" id="about-link" data-content="about">About</a>
        </nav>
    </header>

    <div id="map"></div>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js">
    </script>

    <div class="buttons-container">
        <button onclick="showLayerGroup('bca-buildings-gfa')">Gross Floor Area</button>
        <button onclick="showLayerGroup('bca-buildings-eui')">Energy Use Intensity</button>
        <button onclick="showLayerGroup('bca-buildings-gm')">GreenMark</button>
    </div>

    <div id="data-sub-buttons">
        <button id="info-link" data-content="data">Information</button>
        <button id="download-link" data-content="dataDown">Download</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const bcaLink = document.getElementById('bca-link');
            const dataLink = document.getElementById('data-link');
            const bcaMenu = document.querySelector('.buttons-container');
            const dataMenu = document.getElementById('data-sub-buttons');
            const navLinks = document.querySelectorAll('nav a');  // 获取所有导航链接

            // 初始隐藏两个菜单
            bcaMenu.style.display = 'none';
            dataMenu.style.display = 'none';

            bcaLink.addEventListener('click', (e) => {
                e.preventDefault();
                const isVisible = bcaMenu.style.display === 'block';
                bcaMenu.style.display = isVisible ? 'none' : 'block';
                dataMenu.style.display = 'none';
            });

            dataLink.addEventListener('click', (e) => {
                e.preventDefault();
                const isVisible = dataMenu.style.display === 'block';
                dataMenu.style.display = isVisible ? 'none' : 'block';
                bcaMenu.style.display = 'none';
            });

            // 监听所有导航链接的点击事件
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (link !== dataLink && link !== bcaLink) {
                        dataMenu.style.display = 'none';
                        bcaMenu.style.display = 'none';
                    }
                });
            });
        });
    </script>


    <!-- 图例容器 -->
    <div class="legend-container-bca">
        <!-- GFA 图例 -->
        <div class="legend-content bca-buildings-gfa">
            <div class="legend-name">Gross Floor Area (×10² m²)</div>
            <div class="legend-bar-gfa"></div>
            <div class="legend-labels">
                <span>0</span>
                <span>200</span>
                <span>1000</span>
                <span>2000</span>
            </div>
        </div>

        <!-- EUI 图例 -->
        <div class="legend-content bca-buildings-eui">
            <div class="legend-name">Energy Use Intensity (kW/m²)</div>
            <div class="legend-bar-eui"></div>
            <div class="legend-labels">
                <span>0</span>
                <span>300</span>
                <span>600</span>
            </div>
        </div>

        <!-- GreenMark 图例 -->
        <div class="legend-content bca-buildings-gm">
            <div class="legend-name">GreenMark Certification</div>
            <div class="legend-grid-bca">
                <div class="legend-item-bca">
                    <div class="legend-box-bca greenmark-goldplus"></div>
                    <span>Gold Plus</span>
                </div>
                <div class="legend-item-bca">
                    <div class="legend-box-bca greenmark-gold"></div>
                    <span>Gold</span>
                </div>
                <div class="legend-item-bca">
                    <div class="legend-box-bca greenmark-platinum"></div>
                    <span>Platinum</span>
                </div>
                <div class="legend-item-bca">
                    <div class="legend-box-bca greenmark-legislated"></div>
                    <span>Legislated</span>
                </div>
                <div class="legend-item-bca">
                    <div class="legend-box-bca greenmark-certified"></div>
                    <span>Certified</span>
                </div>
            </div>
        </div>
    </div>

    <div class="legend-container type" style="visibility: visible;">
        <div class="legend-name">Building Types</div>
        <div class="legend-grid">
            <div class="legend-item">
                <div class="legend-box legend-public-housing"></div>
                <span>Public Housing</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-healthcare"></div>
                <span>Healthcare</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-landed-property"></div>
                <span>Landed Property</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-commercial"></div>
                <span>Commercial</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-private-apartment"></div>
                <span>Private Apt.</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-industrial"></div>
                <span>Industrial</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-other-dwelling"></div>
                <span>Other Dwelling</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-others"></div>
                <span>Others</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-educational"></div>
                <span>Educational Inst.</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-unknown"></div>
                <span>Unknown</span>
            </div>
        </div>
    </div>

    <div class="legend-container carbon">
        <div class="legend-name">Simulated Embodied Carbon (×10² kgCO₂e)</div>
        <div class="legend-main">
            <div class="legend-bar-carbon"></div>
            <div class="legend-labels">
                <span>5</span>
                <span>50</span>
                <span>500</span>
                <span>5000</span>
            </div>
        </div>
    </div>

    <div class="legend-container energy">
        <div class="legend-name">Simulated Operational Carbon (×10⁴ kgCO₂e)</div>
        <div class="legend-main">
            <div class="legend-bar-energy"></div>
            <div class="legend-labels">
                <span>5</span>
                <span>50</span>
                <span>500</span>
                <span>5000</span>
            </div>
        </div>
    </div>

    <!--popup for data and about-->
    <div id="overlay" class="overlay"></div>
    <div id="popup" class="popup">
        <div class="popup-content">
            <div id="popup-text"></div>
            <div id="popupDownload">
                <h2 style="font-weight: 500; width: 100%;">Download IDF Files for Energyplus</h2>
                <p>This section provides the IDF file used in this project for building performance simulation in EnergyPlus under Singapore’s climate. You can download it to explore the building’s operational energy analysis or run your own simulations based on our model settings.</p>
                <div id="downloadGridIDF" class="download-grid">
                    <div class="download-item" download-file="HDB PPVC.idf">
                        <img src="image/HDB PPVC.jpg" alt="HDB PPVC.jpg">
                        <span class="download-label">HDB PPVC</span>
                        <div class="download-tooltip">Download HDB PPVC IDF File</div>
                    </div>
                    <div class="download-item" download-file="01_HDB_SGP_2025_V5.idf">
                        <img src="image/HDB non-PPVC.jpg" alt="HDB non-PPVC.jpg">
                        <span class="download-label">HDB Non-PPVC</span>
                        <div class="download-tooltip">Download HDB Non-PPVC IDF File</div>
                    </div>
                    <div class="download-item" download-file="02_SFH_SGP_2025_V5.idf">
                        <img src="image/Landed property.jpg" alt="Landed property.jpg">
                        <span class="download-label">Landed Property</span>
                        <div class="download-tooltip">Download Landed Property IDF File</div>
                    </div>
                    <div class="download-item" download-file="03_MFH_SGP_2025_V5.idf">
                        <img src="image/Private apartment & condo.jpg" alt="Private apartment & condo.jpg">
                        <span class="download-label">Private Apartment & Condo</span>
                        <div class="download-tooltip">Download Private Apartment & Condo IDF File</div>
                    </div>
                    <div class="download-item" download-file="04_Hotel_SGP_2025_V5.idf">
                        <img src="image/Hotel.jpg" alt="Hotel.jpg">
                        <span class="download-label">Hotel</span>
                        <div class="download-tooltip">Download Hotel IDF File</div>
                    </div>
                    <div class="download-item" download-file="Shophouse.idf">
                        <img src="image/Shophouse.jpg" alt="Shophouse.jpg">
                        <span class="download-label">Shophouse</span>
                        <div class="download-tooltip">Download Shophouse IDF File</div>
                    </div>
                    <div class="download-item" download-file="05_Retail_SGP_2025_V5.idf">
                        <img src="image/Retail.jpg" alt="Retail.jpg">
                        <span class="download-label">Retail</span>
                        <div class="download-tooltip">Download Retail IDF File</div>
                    </div>
                    <div class="download-item" download-file="Mixed development.idf">
                        <img src="image/Mixed development.jpg" alt="Mixed development.jpg">
                        <span class="download-label">Mixed Development</span>
                        <div class="download-tooltip">Download Mixed Development IDF File</div>
                    </div>
                    <div class="download-item" download-file="06_Office_SGP_2025_V5.idf">
                        <img src="image/Office.jpg" alt="Office.jpg">
                        <span class="download-label">Office</span>
                        <div class="download-tooltip">Download Office IDF File</div>
                    </div>
                    <div class="download-item" download-file="07_BusinessPark_SGP_2025_V5.idf">
                        <img src="image/Business park.jpg" alt="Business park.jpg">
                        <span class="download-label">Business Park</span>
                        <div class="download-tooltip">Download Business Park IDF File</div>
                    </div>
                    <div class="download-item" download-file="08_Hospital_SGP_2025_V5.idf">
                        <img src="image/Hospital.jpg" alt="Hospital.jpg">
                        <span class="download-label">Hospital</span>
                        <div class="download-tooltip">Download Hospital IDF File</div>
                    </div>
                    <div class="download-item" download-file="09_Polyclinic_SGP_2025_V5.idf">
                        <img src="image/Clinic.jpg" alt="Clinic.jpg">
                        <span class="download-label">Clinic</span>
                        <div class="download-tooltip">Download Clinic IDF File</div>
                    </div>
                    <div class="download-item" download-file="10_NursingHome_SGP_2025_V5.idf">
                        <img src="image/Nursing home.jpg" alt="Nursing home.jpg">
                        <span class="download-label">Nursing Home</span>
                        <div class="download-tooltip">Download Nursing Home IDF File</div>
                    </div>
                    <div class="download-item" download-file="11_IHL_SGP_2025_V5.idf">
                        <img src="image/Inst. of higher learning (IHL).jpg" alt="Inst. of higher learning (IHL).jpg">
                        <span class="download-label">Inst. of Higher Learning (IHL)</span>
                        <div class="download-tooltip">Download Inst. of Higher Learning (IHL) IDF File</div>
                    </div>
                    <div class="download-item" download-file="12_NonIHL_SGP_2025_V5.idf">
                        <img src="image/Non-IHL.jpg" alt="Non-IHL.jpg">
                        <span class="download-label">Non-IHL</span>
                        <div class="download-tooltip">Download Non-IHL IDF File</div>
                    </div>
                    <div class="download-item" download-file="13_IndustrialB1_SGP_2025_V5.idf">
                        <img src="image/B1.jpg" alt="B1.jpg">
                        <span class="download-label">Industrial B1</span>
                        <div class="download-tooltip">Download Industrial B1 IDF File</div>
                    </div>
                    <div class="download-item" download-file="14_IndustrialB2_SGP_2025_V5.idf">
                        <img src="image/B2.jpg" alt="B2.jpg">
                        <span class="download-label">Industrial B2</span>
                        <div class="download-tooltip">Download Industrial B2 IDF File</div>
                    </div>
                    <div class="download-item" download-file="15_DataCentre_SGP_2025_V5.idf">
                        <img src="image/Data centre.jpg" alt="Data centre.jpg">
                        <span class="download-label">Data Centre</span>
                        <div class="download-tooltip">Download Data Centre IDF File</div>
                    </div>
                    <div class="download-item" download-file="16_CivicCommunity_Cultural_SGP_2025_V5.idf">
                        <img src="image/Civic, community & cultural inst..jpg"
                            alt="Civic, community & cultural inst..jpg">
                        <span class="download-label">Civic, Community & Cultural Inst.</span>
                        <div class="download-tooltip">Download Civic, Community & Cultural Inst. IDF File</div>
                    </div>
                    <div class="download-item" download-file="17_SportsRec_SGP_2025_V5.idf">
                        <img src="image/Sports & recreation.jpg" alt="Sports & recreation.jpg">
                        <span class="download-label">Sports & Recreation</span>
                        <div class="download-tooltip">Download Sports & Recreation IDF File</div>
                    </div>
                    <div class="download-item" download-file="18_Restaurant_SGP_2025_V5.idf">
                        <img src="image/Restaurant.jpg" alt="Restaurant.jpg">
                        <span class="download-label">Restaurant</span>
                        <div class="download-tooltip">Download Restaurant IDF File</div>
                    </div>
                    <div class="download-item" download-file="20_Supermarket_SGP_2025_V5.idf">
                        <img src="image/Supermarket.jpg" alt="Supermarket.jpg">
                        <span class="download-label">Supermarket</span>
                        <div class="download-tooltip">Download Supermarket IDF File</div>
                    </div>
                    <div class="download-item" download-file="19_HawkerCentre_SGP_2025_V5.idf">
                        <img src="image/Hawker centre.jpg" alt="Hawker centre.jpg">
                        <span class="download-label">Hawker Centre</span>
                        <div class="download-tooltip">Download Hawker Centre IDF File</div>
                    </div>
                    <div class="download-item" download-file="AllArhcetypes_SGP_2025_V5.zip">
                        <img src="image/Archetypes_all.jpg" alt="Archetypes_all.jpg">
                        <span class="download-label">All Archetypes</span>
                        <div class="download-tooltip">Download All Archetypes IDF File</div>
                    </div>
                </div>
                <br>

                <h2 style="font-weight: 500; width: 100%;">Download GEOJSON Files</h2>
                <p>This section provides the GeoJSON file containing building geometry across Singapore. You can download it for use in spatial analysis, visualization, or integration with energy simulation tools.</p>
                <div id="downloadGridMap" class="download-grid">
                    <div class="download-item" download-file="sg_buildings_v3.zip">
                        <img src="image/Map_data.jpg" alt="Map_data.jpg">
                        <div class="download-tooltip">Download Map Dataset GEOJSON File</div>
                    </div>
                </div>
            </div>
            <button id="close-btn">Close</button>
            <br>
        </div>
    </div>

    <!--draw polygon and calculating funtion-->
    <div class="calculation-box">
        <button class="closex">&times;</button>
        <h3>Area Information</h3>
        <div id="calculated-area"></div>
    </div>

    <div class="result-panel">
        <div class="simulation-header"></div>
        <!-- Dropdown Menu fro Archetype selecting-->
        <select id="subtype" class="subtype-btn" onchange="updateArchetypes()">
            <option value="">All Type</option>
            <option value="publicHousing">Public Housing</option>
            <option value="privateHousing">Private Housing</option>
            <option value="otherDwelling">Other Dwelling</option>
            <option value="commercial">Commercial</option>
            <option value="healthcare">Healthcare</option>
            <option value="educational">Educational Inst.</option>
            <option value="industrial">Industrial</option>
            <option value="others">Others</option>
        </select>

        <select id="archetype" class="archetype-btn">
            <option value="">All Archetype</option>
        </select>

        <button class="clear-btn" onclick="clearSelections()">Clear</button>
        <button class="panel-close-btn" onclick="panelClose()">&times;</button>

        <div id="archetype-charts">
            <div id="sunchartsnumber"></div>
            <div id="sunchartsfootprint"></div>
            <div class="container">
                <div class="sunchartname">By</div>
                <div class="toggle-container" onclick="toggleSwitch()">
                    <div class="toggle-slider"></div>
                    <div id="numberLabel" class="toggle-option active">Building Numbers</div>
                    <div id="footprintLabel" class="toggle-option">Footprint(10⁴m²)</div>
                </div>
                <div id="downloadSunChart">Download</div>
            </div>
            <div class="type-intro">
                <h3>Archetype Introduction</h3>
                <p id="archetype-description">Select a type or an archetype to view the description.</p>
            </div>
            <script>
                let isNumber = true;
                function toggleSwitch() {
                    isNumber = !isNumber;
                    document.querySelector('.toggle-slider').style.transform = isNumber ? 'translateX(0)' : 'translateX(calc(100% - 6.5px))';
                    document.getElementById('numberLabel').classList.toggle('active', isNumber);
                    document.getElementById('footprintLabel').classList.toggle('active', !isNumber);
                    document.getElementById('sunchartsnumber').style.display = isNumber ? 'flex' : 'none';
                    document.getElementById('sunchartsfootprint').style.display = isNumber ? 'none' : 'flex';
                }

                document.getElementById("downloadSunChart").addEventListener("click", function () {
                    this.classList.add("active");
                    let chart1 = echarts.getInstanceByDom(document.getElementById("sunchartsnumber"));
                    let chart2 = echarts.getInstanceByDom(document.getElementById("sunchartsfootprint"));

                    if (chart1) {
                        let link1 = document.createElement("a");
                        link1.href = chart1.getDataURL({ type: "png", pixelRatio: 2, backgroundColor: "#fff" });
                        link1.download = "archetype_sg_sunchartsnumber.png";
                        link1.click();
                    }

                    if (chart2) {
                        let link2 = document.createElement("a");
                        link2.href = chart2.getDataURL({ type: "png", pixelRatio: 2, backgroundColor: "#fff" });
                        link2.download = "archetype_sg_sunchartsfootprint.png";
                        link2.click();
                    }
                });
            </script>
        </div>

        <div id="carbon-container" class="result-container">
            <div id="carbon-underselect" class="result-underselect">
                <h4>Embodied Carbon Intensity (kgCO₂e/m²)</h4>
                <div id="downloadCarbonBar" class="downloadBar">Download</div>
                <div id="carbonChartContainer" class="ChartContainer"></div>
                <script>
                    let archetypes = [
                        "HDB", "Landed property", "Private apt. & condo.", "Shophouse", "Hotel",
                        "Retail", "Mixed development", "Office", "Business park", "Hospital",
                        "Clinic", "Nursing home", "IHL", "Non-IHL",
                        "Industrial B1", "Industrial B2", "Data centre", "Cultural inst.",
                        "Sports", "Restaurant", "Hawker centre", "Supermarket"
                    ];

                    let values = [646.3, 527.1, 572.2, 848.1, 848.1, 527.4, 604.5, 519.97, 559.1,
                        585.6, 652.9, 600, 546.3, 594.9, 556.4, 637.4, 700, 523.6,
                        561.9, 620, 580, 550];

                    let colorMap = {
                        "HDB": "#1abc9c", "Landed property": "#2ecc71", "Private apt. & condo.": "#3498db",
                        "Shophouse": "#9b59b6", "Hotel": "#9b59b6", "Retail": "#34495e", "Mixed development": "#34495e",
                        "Office": "#34495e", "Business park": "#34495e", "Hospital": "#f1c40f",
                        "Clinic": "#f1c40f", "Nursing home": "#f1c40f", "IHL": "#e67e22",
                        "Non-IHL": "#e67e22", "Industrial B1": "#e74c3c", "Industrial B2": "#e74c3c",
                        "Data centre": "#95a5a6", "Cultural inst.": "#95a5a6",
                        "Sports": "#95a5a6", "Restaurant": "#95a5a6", "Hawker centre": "#95a5a6",
                        "Supermarket": "#95a5a6"
                    };

                    let option = {
                        tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' }, textStyle: { fontSize: 12, color: '#333' }, borderRadius: 10 },
                        grid: { left: '110px', right: '15px', top: '10px', bottom: '20px' },
                        xAxis: { type: 'value', name: 'kgCO₂e/m²', axisLabel: { fontSize: 10, color: '#333' }, max: 900 },
                        yAxis: { type: 'category', data: archetypes.reverse(), axisLabel: { fontSize: 10, color: '#333' } },
                        series: [{
                            type: 'bar',
                            data: values.reverse().map((v, i) => ({ value: v, itemStyle: { color: colorMap[archetypes[i]], borderRadius: [0, 10, 10, 0] } })),
                            label: { show: true, position: 'right', formatter: '{c}', fontSize: 10, color: '#333' }
                        }]
                    };

                    let chart = echarts.init(document.getElementById('carbonChartContainer'));
                    chart.setOption(option);

                    document.getElementById('downloadCarbonBar').addEventListener('click', function () {
                        const imgURL = chart.getDataURL({ pixelRatio: 2, backgroundColor: '#fff' });
                        const link = document.createElement('a');
                        link.href = imgURL;
                        link.download = 'embodied_carbon_intensity_all.png';
                        link.click();
                    });
                </script>
                <p>Select a type then an archetype to view detailed simulation result.</p>
            </div>
            <div id="carbon-subtype" class="result-subtype">
                <h4>Embodied Carbon Intensity (kgCO₂e/m²)</h4>
                <div id="downloadSubCarbonBar" class="downloadBar">Download</div>
                <div id="carbonSubChart" class="subChartContainer"></div>
                <p>Select an archetype to view detailed simulation result.</p>
            </div>
            <div id="carbon-content" class="result-content">
                <div id="image-container-carbon" class="image-container"></div>
                <div class="overview">
                    <h3>Simulation Overview</h3>
                    <p id="carbon-overview">
                        Archetype: <span id="archetype-value"></span><br>
                        Scenario: Baseline<br>
                        Mean EC Intensity: <span id="ec-intensity"></span><br>
                        Fitted Distribution: <span id="fitted-distribution"></span><br>
                        Distribution Parameters: <span id="distribution-params"></span>
                    </p>
                </div>
                <div class="parameters">
                    <h3>Simulation Parameters</h3>
                    <table id="carbon-table">
                        <thead>
                            <tr>
                                <th>Materials</th>
                                <th>Mean Material Intensity</th>
                                <th>Mean Waste Factor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Concrete</td>
                                <td><span id="concreteMI"></span></td>
                                <td><span id="concreteWF"></span></td>
                            </tr>
                            <tr>
                                <td>Steel</td>
                                <td><span id="steelMI"></span></td>
                                <td><span id="steelWF"></span></td>
                            </tr>
                            <tr>
                                <td>Glass</td>
                                <td><span id="glassMI"></span></td>
                                <td><span id="glassWF"></span></td>
                            </tr>
                            <tr>
                                <td>Aluminium</td>
                                <td><span id="alMI"></span></td>
                                <td><span id="alWF"></span></td>
                            </tr>
                            <tr>
                                <td>Brick</td>
                                <td><span id="brickMI"></span></td>
                                <td><span id="brickWF"></span></td>
                            </tr>
                            <tr>
                                <td colspan="2"><strong>Mean onsite emissions</strong></td>
                                <td><span id="meanOnsiteEmissions"></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="carbon-figure" class="figure">
                    <h3>MCS Results</h3>
                    <div id="carbonHistogram"></div>
                </div>
            </div>
        </div>

        <div id="energy-container" class="result-container">
            <div id="energy-underselect" class="result-underselect">
                <h4>Energy Use Intensity (kWh/m²)</h4>
                <div id="downloadEnergyBar" class="downloadBar">Download</div>
                <div id="energyChartContainer" class="ChartContainer"></div>
                <script>
                    const energyChart = echarts.init(document.getElementById('energyChartContainer'));

                    const euiData = {
                        "HDB": [10.93, 2.61, 8.17, 1.52],
                        "Landed property": [26.61, 3.58, 20.42, 0.70],
                        "Private apt. & condo.": [16.39, 3.58, 13.61, 1.44],
                        "Shophouse": [70.00, 15.00, 12.00, 3.00],
                        "Hotel": [81.85, 6.19, 11.16, 2.70],
                        "Retail": [94.03, 12.62, 11.72, 4.93],
                        "Mixed development": [70.00, 15.00, 12.00, 3.00],
                        "Office": [70.00, 15.00, 12.00, 3.00],
                        "Business Park": [42.08, 7.72, 14.15, 1.24],
                        "Hospital": [85.51, 11.48, 14.97, 1.97],
                        "Clinic": [41.60, 5.16, 9.17, 1.11],
                        "Nursing home": [24.67, 4.13, 6.39, 1.80],
                        "IHL": [133.86, 5.00, 10.00, 1.00],
                        "Non-IHL": [0.00, 5.46, 2.87, 0.83],
                        "Industrial B1": [99.87, 9.26, 29.63, 2.31],
                        "Industrial B2": [99.87, 9.26, 29.63, 2.31],
                        "Data centre": [109.22, 9.38, 175.22, 0.63],
                        "Cultural inst.": [47.13, 7.64, 8.94, 7.21],
                        "Sports": [37.60, 9.36, 4.68, 5.06],
                        "Restaurant": [83.72, 9.95, 82.92, 14.15],
                        "Hawker centre": [0.00, 0.00, 86.05, 14.88],
                        "Supermarket": [143.94, 26.78, 66.95, 6.86]
                    };

                    const categoryList = Object.keys(euiData).reverse();
                    const dataValues = Object.values(euiData).reverse();

                    const seriesData = [
                        { name: 'Cooling', type: 'bar', stack: 'total', itemStyle: { color: '#A5F3FC' }, data: dataValues.map(v => v[0]) },
                        { name: 'Interior Lighting', type: 'bar', stack: 'total', itemStyle: { color: '#FFFF00' }, data: dataValues.map(v => v[1]) },
                        { name: 'Electric Equipment', type: 'bar', stack: 'total', itemStyle: { color: '#E0E0E0' }, data: dataValues.map(v => v[2]) },
                        { name: 'Water System', type: 'bar', stack: 'total', itemStyle: { color: '#5a2e14' }, data: dataValues.map(v => v[3]) }
                    ];

                    const chartOption = {
                        tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' }, textStyle: { fontSize: 12, color: '#333' }, borderRadius: 10 },
                        grid: { left: '110px', right: '10px', top: '10px', bottom: '20px' },
                        xAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#333' } },
                        yAxis: { type: 'category', axisLabel: { fontSize: 10, color: '#333', }, data: categoryList },
                        series: seriesData
                    };

                    energyChart.setOption(chartOption);

                    document.getElementById('downloadEnergyBar').addEventListener('click', function () {
                        const imgURL = energyChart.getDataURL({ pixelRatio: 2, backgroundColor: '#fff' });
                        const link = document.createElement('a');
                        link.href = imgURL;
                        link.download = 'operational_carbon_intensity_all.png';
                        link.click();
                    });
                </script>
                <p>Select a type then an archetype to view detailed simulation result.</p>
            </div>
            <div id="energy-subtype" class="result-subtype">
                <h4>Energy Use Intensity (kWh/m²)</h4>
                <div id="downloadSubEnergyBar" class="downloadBar">Download</div>
                <div id="energySubChart" class="SubChart"></div>
                <p>Select an archetype to view detailed simulation result.</p>
            </div>
            <div id="energy-content" class="result-content">
                <div id="image-container-energy" class="image-container"></div>
                <div class="overview">
                    <h3>Simulation Overview</h3>
                    <p id="energy-overview">
                        Archetype: <span id="archetype-val"></span><br>
                        Scenario: Baseline<br>
                        People Density: <span id="people-density"></span><br>
                        Equipment Power Density: <span id="equip-density"></span><br>
                        Lighting Power Density: <span id="light-density"></span>
                    </p>
                </div>
                <div class="parameters">
                    <h3>Simulation Parameters</h3>
                    <table id="energy-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Parameter</th>
                                <th>Value / Range</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Conditioning</td>
                                <td>Cooling Set Point</td>
                                <td><span id="coolingSet"></span></td>
                            </tr>
                            <tr>
                                <td>Conditioning</td>
                                <td>Min Fresh Air Area</td>
                                <td><span id="minFreshAir"></span></td>
                            </tr>
                            <tr>
                                <td>Envelope</td>
                                <td>Roof U-Value</td>
                                <td><span id="roofUval"></span></td>
                            </tr>
                            <tr>
                                <td>Envelope</td>
                                <td>Facade U-Value</td>
                                <td><span id="facadeUval"></span></td>
                            </tr>
                            <tr>
                                <td>Envelope</td>
                                <td>Partition U-Value</td>
                                <td><span id="partitionUval"></span></td>
                            </tr>
                            <tr>
                                <td>Envelope</td>
                                <td>Slab U-Value</td>
                                <td><span id="slabUval"></span></td>
                            </tr>
                            <tr>
                                <td>Infiltration</td>
                                <td>Air Changes per Hour</td>
                                <td><span id="airChange"></span></td>
                            </tr>
                            <tr>
                                <td>HVAC Setting</td>
                                <td>Cooling COP</td>
                                <td><span id="coolingCOP"></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="energy-figure" class="figure">
                    <h3>EUI Results</h3>
                    <div id="energy-eui"></div>
                </div>
                <div id="downloadIDF" class="downloadcharts">Download IDF file (EnergyPlus)</div>
            </div>
        </div>

    </div>

    <button id="toggle2D" title="Switch to 2D view">2D</button>

    <!--ml switch-->
    <div class="mlswitch-wrapper" title="Show Buildings with Machine Learning Generated Parameters">
        <span class="label-text">Buildings with ML Parameters</span>
        <input type="checkbox" id="buildingTypeToggle" class="toggle-mlswitch" checked>
        <label for="buildingTypeToggle" class="mlswitch-label"></label>
    </div>

    <div id="visitor-counter">Total Site Visitors: loading…</div>
    <script>
        const NAMESPACE = 'buildings.sg';
        const KEY = 'visitor-count';

        fetch(`https://api.counterapi.dev/hit/${NAMESPACE}/${KEY}`)
            .then(res => res.json())
            .then(data => {
                document.getElementById('visitor-counter').textContent = 'Total Site Visitors: ' + data.value;
            })
            .catch(err => {
                document.getElementById('visitor-counter').textContent = 'Total Site Visitors: N/A';
                console.error('Visitor count failed:', err);
            });
    </script>

    <!--js-->
    <script src="popup.js"></script>
    <script src="mapbox copy.js"></script>
    <script src="panel.js"></script>

</body>

</html>
